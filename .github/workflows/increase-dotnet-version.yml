name: Increase .Net Version

on:
  workflow_call:
    inputs:
      csproj-location:
        required: true
        type: string
      prerelease:
        required: false
        type: boolean
        default: false
      major:
        required: false
        type: boolean
        default: false
      minor:
        required: false
        type: boolean
        default: false
      patch:
        required: false
        type: boolean
        default: false
    outputs:
      version:
        description: "The new CSPROJ version"
        value: ${{ jobs.version.outputs.version }}

jobs:
  version:
    name: Increase .Net Version
    runs-on: ubuntu-latest
    permissions:
        contents: write
    outputs:
      version: ${{ steps.package_version.outputs.version }}

    steps:
        - name: Checkout
          uses: actions/checkout@v3
  
        - name: Bump version
          id: package_version
          uses: KageKirin/bump-csproj-version@v0
          with:
            file: ${{ inputs.csproj-location }}
            major: ${{ inputs.major }}
            minor: ${{ inputs.minor }}
            patch: ${{ inputs.patch }}
            prerelease: ${{ inputs.prerelease }}
  
        - name: Tag commit
          if: github.event.pull_request.merged == true && github.event.pull_request.base.ref == 'main'
          uses: tvdias/github-tagger@v0.0.1
          with:
              repo-token: "${{ secrets.GITHUB_TOKEN }}"
              tag: "v${{ steps.package_version.outputs.version }}"
        
        - name: Commit new version
          uses: stefanzweifel/git-auto-commit-action@v5
